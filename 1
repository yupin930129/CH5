from django.urls import path
from . import views

urlpatterns = [
    path('index/', views.index),
    path('post/', views.post),               # POST 傳送表單
    path('post1/', views.post1),             # 資料新增，資料不驗證
    path('post2/', views.post2),             # 資料新增，資料驗證
    path('postform/', views.postform),       # 表單驗證
    path('delete/<int:id>/', views.delete),  # 刪除資料
]
# models.py
from django.db import models

class Student(models.Model):
    name = models.CharField(max_length=50)
    age = models.IntegerField()
# forms.py
from django import forms
from .models import Student

class StudentForm(forms.ModelForm):
    class Meta:
        model = Student
        fields = ['name', 'age']
# views.py
from django.shortcuts import render, redirect, get_object_or_404
from .models import Student
from .forms import StudentForm

def index(request):
    students = Student.objects.all()
    return render(request, 'index.html', {'students': students})

def post(request):
    if request.method == 'POST':
        name = request.POST.get('name')
        age = request.POST.get('age')
        return render(request, 'post_result.html', {'name': name, 'age': age})
    return render(request, 'post_form.html')

def post1(request):
    if request.method == 'POST':
        name = request.POST.get('name')
        age = request.POST.get('age')
        Student.objects.create(name=name, age=age)
        return redirect('/index/')
    return render(request, 'post_form.html')

def post2(request):
    if request.method == 'POST':
        name = request.POST.get('name')
        age = request.POST.get('age')
        if name and age.isdigit():
            Student.objects.create(name=name, age=int(age))
            return redirect('/index/')
        return render(request, 'post_form.html', {'error': '資料格式錯誤'})
    return render(request, 'post_form.html')

def postform(request):
    if request.method == 'POST':
        form = StudentForm(request.POST)
        if form.is_valid():
            form.save()
            return redirect('/index/')
    else:
        form = StudentForm()
    return render(request, 'postform.html', {'form': form})

def delete(request, id):
    student = get_object_or_404(Student, id=id)
    student.delete()
    return redirect('/index/')
<form method="post">
    {% csrf_token %}
    姓名：<input type="text" name="name"><br>
    年齡：<input type="text" name="age"><br>
    <input type="submit" value="送出資料" />
</form>
{% if error %}
    <p style="color:red">{{ error }}</p>
{% endif %}
<form method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <input type="submit" value="送出資料" />
</form>
<h2>學生資料</h2>
<ul>
    {% for student in students %}
        <li>{{ student.name }}（{{ student.age }} 歲） 
        - <a href="/delete/{{ student.id }}/">刪除</a></li>
    {% endfor %}
</ul>
<h2>送出結果</h2>
<p>姓名：{{ name }}</p>
<p>年齡：{{ age }}</p>
<a href="/index/">回首頁</a>
